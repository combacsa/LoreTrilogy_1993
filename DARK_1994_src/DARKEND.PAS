Unit DarkEnd;

INTERFACE

Uses
   Crt, Graph, AdLib, UHanX, DarkSub;

 Procedure End_Demo;


IMPLEMENTATION

Procedure FadeSub(adder : integer);
var
   color, r, g, b : byte;
begin
   for color := 0 to 14 do begin
      case color of
         0 : begin
                r := adder div 5; g := adder div 5; b := adder div 5;
             end;
         1 : begin
                r := adder div 5; g := adder div 5; b := 42 + adder div 15;
             end;
         2 : begin
                r := adder div 5; g := 42 + adder div 15; b := adder div 5;
             end;
         3 : begin
                r := adder div 5; g := 42 + adder div 15; b := 42 + adder div 15;
             end;
         4 : begin
                r := 42 + adder div 15; g := adder div 5; b := adder div 5;
             end;
         5 : begin
                r := 42 + adder div 15; g := adder div 5; b := 42 + adder div 15;
             end;
         6 : begin
                r := 42 + adder div 15; g := 21 + adder * 2 div 15; b := adder div 5;
             end;
         7 : begin
                r := adder div 15 + 42; g := adder div 15 + 42; b := adder div 15 + 42;
             end;
         8 : begin
                r := 21 + adder * 2 div 15;
                g := 21 + adder * 2 div 15;
                b := 21 + adder * 2 div 15;
             end;
         9 : begin
                r := adder div 5; g := adder div 5; b := 62;
             end;
        10 : begin
                r := adder div 5; g := 62; b := adder div 5;
             end;
        11 : begin
                r := adder div 5; g := 62; b := 62;
             end;
        12 : begin
                r := 62; g := adder div 5; b := adder div 5;
             end;
        13 : begin
                r := 62; g := adder div 5; b := 62;
             end;
        14 : begin
                r := 62; g := 62; b := adder div 5;
             end;
      end;
      SetPalette(color,color);
      RGB(color,r,g,b);
   end;
end;

Procedure FadeIn;
var
   adder : byte;
begin
   for adder := 0 to 31 do FadeSub(adder*10);
end;

Procedure FadeOut;
var
   adder : byte;
begin
   for adder := 31 downto 0 do FadeSub(adder*10);
end;

Procedure EndMessage;
var
   x_pos, y_pos : integer;

 Procedure out(s : string);
 begin
    cHPrint(x_pos,y_pos,s);
    y_pos := y_pos + 20;
 end;

begin
   x_pos := 50; y_pos := 50;
   SetColor(14);
   out(' 나는 그전부터 이런 운명이 당신에게 찾아 올 거라는 것을 알고 있');
   out('있었네. 벌써 이와 같은 일을 나는 셀 수 없이 겪었다네. 자네는 이');
   out('해하겠나 ? 자네가 자네의 차원에서 나를 이기기 전에, 내가 쫒겨난');
   out('그 전의 차원에서의 자네가 나에게 이런 식으로 다시 와서  나의 손');
   out('에 죽었다네. 내가 자네의 차원에서 패해서 블랙홀을 통해서 여기의');
   out('차원으로 오면서도 패배감은 전혀 없었다네. 그건 자네가 다시 이런');
   out('모습으로  내 앞에 나타난다는 것을 알고 있었기 때문이지.  자네는');
   out('결국 알게 될 걸세.  나는 이 모든 차원을 통하여 단 1 명이지만 자');
   out('네는 자네와 같은 운명을 지니고 그 차원을 살아가는 셀 수 없이 많');
   out('은 자네들중에 한명이라네. 내가 지금 여기서 당신을 죽이더라도 이');
   out('차원에 살고 있는 자네에 의해 다시 다른 차원으로 쫒겨 날 것이네.');
   out('하지만 그도 곧 나에게 죽으러 올 것이라는 것을 알수 있겠지.');
   out(' 나 네크로만서는 어느 차원에서도 궁극적으로는 패배를 할 수가 없');
   out('다네. 즉, 나를 이기는 자는 아무도 없지.');
   y_pos := y_pos + 10;
   SetColor(15);
   out(' 인 산크트 그라브 ..  인 바스 프람 ..');
   y_pos := y_pos + 10;
   SetColor(7);
   out(' 네크로만서는 에너지 장막으로 당신을 가둔채 화염 폭풍으로 더 이');
   out('상 저항하지 못하는 당신을 공격 했다. 당신은 희미한 의식속에서도');
   out('몸이 찢겨나가는 것을 느꼈다. 이것으로서 로어의 세계는 실리안 카');
   out('미너스가 애시당초 존재하지 않았던 차원으로 바뀌었다.');
end;

Procedure ThunderEffect;
begin
   SetPalette(6,6);
   RGB(6,40,20,0);
   repeat
      if random(1000) = 0 then
      if random(100) = 0 then begin
         RGB(6,10,20,63);
         delay(random(100)+20);
         RGB(6,40,20,0);
      end;
   until keypressed;
   c := readkey;
end;

Procedure PutSprite(x,y,number : integer);
begin
   PutImage(x,y,Chara^[number+28],AndPut);
   PutImage(x,y,Chara^[number],OrPut);
end;

Procedure End_Demo;
var
   i, j : integer;
begin
   Delete_Scroll_Screen;
   Clear;
   Print(7,' 일행은 자신들이 가지고 있는 모든 힘을 다해');
   Print(7,'서  당신을 네크로만서가 있는 공간으로  차원');
   Print(7,'이탈을 시켰다. 차원 이탈중 당신의 갑옷은 파');
   Print(7,'괴되고 체력은 떨어졌다.  그리고 당신의 의식');
   Print(7,'이 돌아 왔을때  이미 네크로만서는 당신 앞에');
   Print(7,'서 있었다. 그는 말을 시작했다.');
   c := readkey;
   SetFont(0);
   FadeIn;
   SetBkColor(0);
   ClearDevice;
   EndMessage;
   FadeOut;
   while KeyPressed do c := readkey;
   RGB(6,10,20,63);
   delay(40);
   RGB(6,40,20,0);
   delay(100);
   RGB(6,10,20,63);
   delay(100);
   RGB(6,40,20,0);
   SetFont(2);
   with party do begin
      map := 6; xaxis := 91; yaxis := 80;
   end;
   Load;
   ThunderEffect;
   FadeIn;
   SetFillStyle(SolidFill,8);
   Bar(0,0,640,480);
   SoundOn := FALSE;
   party.etc[1] := 255;
   Scroll(FALSE);
   FadeOut;
   PressAnyKey;
   PutImage(98,11*24,Font^[50],CopyPut);
   for i := 10 downto 6 do begin
      delay(1000);
      PutImage(98,(i+1)*24,Font^[47],CopyPut);
      PutImage(98,i*24,Font^[50],CopyPut);
   end;
   Print(7,' '+player[1].name+'님은 지하 세계로 간 뒤 소식이 없다지 ?');
   Print(7,'그나 저나 알비레오의 예언은 틀렸다고들 하던');
   Print(7,'데.  다크 메이지는 결국 나타나지 않았잖아.');
   Print(7,'그러면 세번째, 네번째, 다섯번째 예언은 모두');
   Print(7,'틀렸군.');
   Print(7,' 세번째 예언은 네크로만서가 '+player[1].name+'님에게 패배 했으니까 틀렸지.');
   Print(7,' 네번째 예언은  다크 메이지가 나타나지 않았');
   Print(7,'기 때문에 틀렸지.');
   Print(7,' 그리고 다섯번째 예언은  틀린 예언이 한가지');
   Print(7,'가 아니라 세가지라서 틀렸지.');
   Print(7,' 어때 ? 내 말이 맞지 ?');
   PressAnyKey;
   FadeIn;

   if AdLibOn then PlayOff;
   UnSound;
   asm
      mov ah,0
      mov al,3
      int $10
      mov ah,1
      mov ch,$20
      int $10
   end;
   dispose(font); dispose(chara);
   dispose(map); dispose(enemydata);
   TextColor(7);
   TextBackGround(0);
   ClrScr;
   TextColor(7);
   Writeln(#13);
   RGB(7,0,0,0);
   SetPalette(15,15);
   RGB(15,0,0,0);
   TextColor(15);
   Writeln(#13);
   Writeln('                              << The End >>');
   Writeln('    " Dark Mage Cyllian Cominus  vol. #2 " is made by Ahn Young-Kie.');
   TextColor(7);
   Writeln('                        You must be a genius !!!');
   for i := 1 to 63 do begin
      RGB(7,i,i,i);
      SetPalette(15,15);
      RGB(15,i,i,i);
      delay(10);
   end;
   delay(500);
   for i := 62 downto 42 do begin
      RGB(7,i,i,i);
      delay(15);
   end;
   asm
      mov ah,1
      mov ch,$13
      mov cl,$14
      int $10
   end;
   Halt;
end;

end.