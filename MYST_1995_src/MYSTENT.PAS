Unit MystEnt;
{$O+,F+}
INTERFACE

Uses
   Crt, Graph, UHanX, MystSub, MystBatt, MystEnd, MystTalk;

 Procedure EnterMode;
 Procedure Sign;


IMPLEMENTATION

Procedure EnterMode;
begin
   if mapname = 'Ground1' then begin
      if at(20,11) then begin
         if wantenter('로어성') then begin
            if party.year < 700 then begin
               mapname := 'Lore';
               Load;
               Scroll(TRUE);
               if getbit(35) then PutMap(41,10,44);
               if getbit(36) then PutMap(22,50,44);
               if getbit(37) then PutMap(22,54,44);
               if getbit(38) then PutMap(18,38,47);
            end else begin
               mapname := 'Dark';
               Load;
               Scroll(TRUE);
            end;
         end;
      end;
      if at(76,57) then begin
         if party.year > 699 then begin
            Clear;
            Print(7,' 당신이  라스트디치 성으로  들어가려 했지만');
            Print(7,'그곳 주민으로 등록되지 않은 이방인이란 이유');
            Print(7,'로 쫒겨났다.');
            exit;
         end;
         if wantenter('라스트디치성') then begin
            mapname := 'LastDtch';
            Load;
            Scroll(TRUE);
            if getbit(39) then PutMap(61,58,44);
            if getbit(41) then PutMap(34,30,47);
         end;
      end;
      if at(17,89) then begin
         if party.year > 699 then begin
            Clear;
            Print(7,' 당신이 메너스로 들어가려 했지만  이미 이곳');
            Print(7,'은 폐광이 된데다가 입구마저 함몰되어 도저히');
            Print(7,'들어갈 수가 없었다.');
            exit;
         end;
         if wantenter('메너스') then begin
            mapname := 'Menace';
            Load;
            Scroll(TRUE);
         end;
      end;
   end;

   if mapname = 'LastDtch' then begin
      if at(38,10) or at(39,10) then begin
         if wantenter('가이아 게이트') then begin
            if not getbit(50) then begin
               DefaultEnter;
               if getbit(40) then PutMap(17,24,27);
               if getbit(42) then PutMap(56,40,27);
            end
            else begin
               absolute_set_xy := TRUE;
               with Map_Header do begin
                  x := EnterX; y := EnterY;
                  mapname := 'Light';
               end;
               Load;
               Scroll(TRUE);
               absolute_set_xy := FALSE;
               x1 := 0; y1 := 0;
            end;
         end;
      end;
   end;

   if (mapname = 'Valiant') or (mapname = 'Light') then begin
      if at(38,10) or at(39,10) then begin
         if wantenter('로어 게이트') then begin
            DefaultEnter;
            if getbit(39) then PutMap(61,58,44);
            if getbit(41) then PutMap(34,30,47);
         end;
      end;
   end;

   if mapname = 'Ground2' then begin
      if at(19,26) then begin
         if wantenter('배리언트 피플즈성') then begin
            if not getbit(50) then
               mapname := 'Valiant'
            else
               mapname := 'Light';
            Load;
            Scroll(TRUE);
            if not getbit(50) then begin
               if getbit(40) then PutMap(17,24,27);
               if getbit(42) then PutMap(56,40,27);
            end;
         end;
      end;
      if at(31,82) then begin
         if wantenter('가이아 테라성') then begin
            mapname := 'Gaea';
            Load;
            if getbit(43) then PutMap(25,9,44);
            if getbit(44) then PutMap(11,36,44);
            Scroll(TRUE);
         end;
      end;
      if at(82,47) then begin
         if wantenter('오크 마을') then begin
            mapname := 'OrcTown';
            Load;
            if getbit(57) then PutMap(10,39,34);
            if getbit(58) then PutMap( 9,19,34);
            if getbit(59) then PutMap(13,12,34);
            if getbit(60) then PutMap(21, 9,34);
            if getbit(61) then PutMap(43,12,34);
            if getbit(62) then PutMap(44,30,34);
            if getbit(63) then PutMap(35,29,34);
            if getbit(64) then PutMap(41,39,34);
            if getbit(53) then begin
               PutMap(25,42,43); PutMap(25,43,43);
            end;
            if getbit(54) then begin
               PutMap(24,20,43); PutMap(26,20,43);
            end;
            if getbit(55) then PutMap(23,18,43);
            if getbit(56) then begin
               PutMap(25,17,43); PutMap(26,17,43);
            end;
            Scroll(TRUE);
         end;
      end;
   end;

   if mapname = 'Ground3' then begin
      if at(69,29) and wantenter('베스퍼성') then begin
         absolute_set_xy := TRUE;
         mapname := 'Vesper';
         if x1 = 1 then begin
            x := 6; y := 38;
         end;
         if x1 = -1 then begin
            x := 70; y := 38;
         end;
         if y1 = 1 then begin
            x := 38; y := 7;
         end;
         if y1 = -1 then begin
            x := 38; y := 69;
         end;
         Load;
         if getbit(65) then PutMap(30,19,43);
         if getbit(66) then PutMap(50,19,43);
         if getbit(67) then PutMap(64,26,43);
         if getbit(68) then PutMap(61,33,43);
         if getbit(69) then PutMap(40,40,43);
         if getbit(70) then PutMap(22,40,43);
         if getbit(71) then PutMap(20,26,43);
         Scroll(TRUE);
         absolute_set_xy := FALSE;
         exit;
      end;

      if at(81,15) and wantenter('트롤 마을') then begin
         mapname := 'TrolTown';
         Load;
         if getbit(46) then PutMap(37,17,44);
         if getbit(72) then begin
            PutMap(25,8,44); PutMap(26,8,44);
         end;
         if getbit(73) then PutMap(17,19,44);
         if getbit(74) then PutMap(34,19,44);
         if getbit(75) then begin
            PutMap(13,32,44); PutMap(13,33,44);
         end;
         if getbit(76) then begin
            PutMap(38,32,44); PutMap(38,33,44);
         end;
         if getbit(77) then begin
            PutMap(24,67,44); PutMap(25,67,44); PutMap(26,67,44);
         end;
         if getbit(78) then PutMap( 6,31,44);
         if getbit(79) then PutMap( 9,30,44);
         if getbit(80) then PutMap( 7,33,44);
         if getbit(81) then PutMap(11,35,44);
         if getbit(82) then PutMap(40,30,44);
         if getbit(83) then PutMap(41,35,44);
         if getbit(84) then PutMap(43,32,44);
         if getbit(85) then PutMap(45,34,44);
         Scroll(TRUE);
         exit;
      end;

      if at(81,76) then begin
         Clear;
         if getbit(10) then begin
            if not getbit(9) then begin
               Print(7,' 당신이 기묘한 비석 앞에 섰을때 그것은 트롤');
               Print(7,'글로 적힌 주문이란걸 알았다. 당신은 낮은 소');
               Print(7,'리로 그 주문을 읖조렸다.  순간 비석이  둘로');
               Print(7,'쪼개어지며 에테르체의 형상이 나타났다. 그리');
               Print(7,'고는 서서히 생체 프라즈마질의 트롤 형상으로');
               Print(7,'변해갔다.  그것이 완전한 트롤의 형상으로 변');
               Print(7,'하자  내게 무어라 알수 없는 말을 지껄이더니');
               Print(7,'다시 당신의 모습으로 닮아갔다.  당신의 모습');
               Print(7,'으로 변한 플라즈마체의 기운은 서서히 당신의');
               Print(7,'몸속에 스며 들어갔다. 그 알수 없는 존재와의');
               Print(7,'결합이 끝났을때  당신은  그 존재가 지껄였던');
               Print(7,'말이 트롤족의 말이었음을 알게 되었다.  그리');
               Print(7,'고  이제 당신이  트롤족의 말을 할 수 있다는');
               Print(7,'걸 깨닭게 되었다.');
               setbit(9);
            end else begin
               Print(7,' 당신 앞에는  반으로 쪼개어진 비석만 남아있');
               Print(7,'었다.');
            end;
         end else begin
            Print(7,' 당신 앞에는 기묘한 도형이 새겨진 비석이 서');
            Print(7,'있었다.');
         end;
      end;
   end;

   if mapname = 'Ground4' then begin
      if at(82,16) then begin
         if getbit(86) then begin
            Clear;
            Print(7,' 당신은  코볼트킹을 가둬놓기 위해 만든 로드');
            Print(7,'안의 결계 때문에 안으로 들어갈 수 없었다.');
            exit;
         end;
         if wantenter('코볼트 마을') then begin
            mapname := 'Kobold';
            Load;
            Scroll(TRUE);
            if party.etc[30] = 0 then
               party.etc[30] := ((random(5)+1) shl 4) + (random(5) + 1);
            if party.etc[31] = 0 then
               party.etc[31] := random(31) + 1;
         end;
      end;
      if at(20,39) then begin
         if wantenter('에인션트이블 신전') then begin
            absolute_set_xy := TRUE;
            mapname := 'Ancient';
            if x1 = 1 then begin
               x := 6; y := 15;
            end;
            if x1 = -1 then begin
               x := 14; y := 15;
            end;
            if y1 = 1 then begin
               x := 10; y := 7;
            end;
            if y1 = -1 then begin
               x := 10; y := 24;
            end;
            Load;
            if getbit(28) then for i := 10 to 11 do PutMap(i,17,44);
            if getbit(23) then for i := 10 to 11 do PutMap(i,13,44);
            Scroll(TRUE);
            absolute_set_xy := FALSE;
            exit;
         end;
      end;
      if at(48,57) then begin
         if wantenter('오두막집') then begin
            absolute_set_xy := TRUE;
            mapname := 'Hut';
            if x1 = 1 then begin
               x := 6; y := 15;
            end;
            if x1 = -1 then begin
               x := 25; y := 15;
            end;
            if y1 = 1 then begin
               x := 15; y := 7;
            end;
            if y1 = -1 then begin
               x := 15; y := 24;
            end;
            Load;
            if getbit(204) then PutMap(8,13,35);
            if getbit(205) then PutMap(8,14,35);
            Scroll(TRUE);
            absolute_set_xy := FALSE;
            exit;
         end;
      end;
      if at(26,16) then begin
         Clear;
         Print(12,' 여기는 ''발하라 전당''.');
         Print(12,' 시간 관계상 제작을 하지 못했음.');
         Print(12,'');
         Print(7,'                       제작자 씀.');
     end;
   end;

   if mapname = 'Ancient' then begin
      if at(10,23) then begin
         if getbit(12) then begin
            if getbit(11) then exit;
            Clear;
            Print(7,' 당신은 코볼트글로 되어 있는 기둥을 보았다.');
            Print(7,'그리고 그곳에 적힌 글을 읽자  당신의 머리속');
            Print(7,'을 꽉 채우는 무언가를 느꼈다.');
            setbit(11);
         end else begin
            Print(7,' 당신 앞에는  처음 보는 문자가 적힌  기둥이');
            Print(7,'서 있었다.');
         end;
      end;
   end;

   if mapname = 'Ground5' then begin
      if at(39,36) then
      if wantenter('드라코니안 마을') then begin
         mapname := 'DracTown';
         Load;
         if getbit(111) then PutMap(24,98,44);
         if getbit(112) then PutMap(24,92,44);
         if getbit(113) then PutMap(25,81,44);
         if getbit(114) then PutMap(34,100,44);
         if getbit(115) then PutMap(36,93,44);
         if getbit(116) then PutMap(42,84,44);
         if getbit(117) then PutMap(33,82,44);
         if getbit(118) then PutMap(41,70,44);
         if getbit(119) then PutMap(32,22,44);
         if getbit(120) then PutMap(40,33,44);
         if getbit(121) then PutMap(16,19,44);
         if getbit(122) then PutMap(16,35,44);
         if getbit(123) then PutMap(15,48,44);

         if getbit(47) then PutMap(15,57,44);

         if getbit(104) then PutMap(77,73,44);
         if getbit(105) then PutMap(67,66,44);
         if getbit(106) then PutMap(67,73,44);
         if getbit(107) then PutMap(62,71,44);
         if getbit(108) then PutMap(67,88,44);
         if getbit(109) then PutMap(62,79,44);
         if getbit(110) then PutMap(65,64,44);

         if getbit(103) then begin
            PutMap(14,105,44); PutMap(15,106,44);
         end;
         if getbit(102) then begin
            for j := 59 to 61 do
            for i := 47 to 48 do PutMap(i,j,44);
         end;
         if getbit(101) then begin
            for i := 24 to 27 do PutMap(i,54,44);
         end;
         if getbit(100) then begin
            for j := 59 to 61 do PutMap(84,j,44);
         end;
         if getbit( 99) then begin
            for i := 79 downto 77 do PutMap(i,88,44);
         end;
         if getbit( 98) then begin
            for i := 59 to 61 do PutMap(i,48,44);
         end;
         if getbit( 97) then begin
            for i := 73 to 75 do PutMap(i,40,44);
         end;
         if getbit( 96) then begin
            for i := 94 to 96 do PutMap(i,37,44);
         end;
         if getbit( 95) then begin
            PutMap(102,20,44); PutMap(102,21,42);
            PutMap(101,21,44); PutMap(103,21,44);
         end;

         Scroll(TRUE);
      end;
      if at(15,31) then begin
         if wantenter('임페리엄 마이너성') then begin
            mapname := 'Imperium';
            Load;
            Scroll(TRUE);
         end;
      end;
   end;

   if mapname = 'Tomb' then begin
      if wantexit then begin
         DefaultExit;
         if getbit(111) then PutMap(24,98,44);
         if getbit(112) then PutMap(24,92,44);
         if getbit(113) then PutMap(25,81,44);
         if getbit(114) then PutMap(34,100,44);
         if getbit(115) then PutMap(36,93,44);
         if getbit(116) then PutMap(42,84,44);
         if getbit(117) then PutMap(33,82,44);
         if getbit(118) then PutMap(41,70,44);
         if getbit(119) then PutMap(32,22,44);
         if getbit(120) then PutMap(40,33,44);
         if getbit(121) then PutMap(16,19,44);
         if getbit(122) then PutMap(16,35,44);
         if getbit(123) then PutMap(15,48,44);

         if getbit(47) then PutMap(15,57,44);

         if getbit(104) then PutMap(77,73,44);
         if getbit(105) then PutMap(67,66,44);
         if getbit(106) then PutMap(67,73,44);
         if getbit(107) then PutMap(62,71,44);
         if getbit(108) then PutMap(67,88,44);
         if getbit(109) then PutMap(62,79,44);
         if getbit(110) then PutMap(65,64,44);

         if getbit(103) then begin
            PutMap(14,105,44); PutMap(15,106,44);
         end;
         if getbit(102) then begin
            for j := 59 to 61 do
            for i := 47 to 48 do PutMap(i,j,44);
         end;
         if getbit(101) then begin
            for i := 24 to 27 do PutMap(i,54,44);
         end;
         if getbit(100) then begin
            for j := 59 to 61 do PutMap(84,j,44);
         end;
         if getbit( 99) then begin
            for i := 79 downto 77 do PutMap(i,88,44);
         end;
         if getbit( 98) then begin
            for i := 59 to 61 do PutMap(i,48,44);
         end;
         if getbit( 97) then begin
            for i := 73 to 75 do PutMap(i,40,44);
         end;
         if getbit( 96) then begin
            for i := 94 to 96 do PutMap(i,37,44);
         end;
         if getbit( 95) then begin
            PutMap(102,20,44); PutMap(102,21,42);
            PutMap(101,21,44); PutMap(103,21,44);
         end;

         for i := 2 to 5 do begin
            for j := 0 to 8 do player[i].name[j] := player[i].name[j+9];
         end;
         Display_Condition;
      end;
   end;

   if mapname = 'HdsGate' then begin
      if at(21,33) then begin
         if party.etc[25] = 2 then begin
            if wantenter('하데스 테라') then begin
               DefaultEnter;
            end;
         end
         else begin
            Clear;
            Print(13,' 지하 세계의 입구에서 무언가 강한 힘이 뿜어');
            Print(13,'져 나와 당신을 밀쳐내 버렸다.');
         end;
      end;
   end;

   if mapname = 'Vesper' then TalkMode;
   if mapname = 'TrolTown' then TalkMode;

end;

Procedure Sign;
begin
   while keypressed do c := readkey;
   Clear;
   if mapname = 'OrcTown' then begin
      TalkMode;
      exit;
   end;
   if mapname = 'Vesper' then begin
      TalkMode;
      exit;
   end;
   if mapname = 'TrolTown' then begin
      TalkMode;
      exit;
   end;
   if mapname = 'Tomb' then begin
      TalkMode;
      exit;
   end;

   yline := 30; hany := 16;
   Print(7,'푯말에 쓰여있기로 ...');
   Print(7,''); Print(7,'');

   if mapname = 'Lore' then begin
      if at(51,84) then begin
         Print(15,'          이곳은 로어성입니다.');
         Print(15,'          여러분을 환영합니다.');
         Print(7,'');
         Print(7,'');
         Print(10,'         이곳의 성주 로드안 씀');
      end;
      if at(51,15) then Print(15,'      로어 왕립 죄수 수용소');
      if at(24,31) then begin
         Print(15,'             로어 주점');
         Print(15,'');
         Print(15,'      ( 코리아 위스키 전문점 )');
      end;
      if at(51,58) then
      if getbit(50) then begin
         Print(15,'     이제 우리를 위협하던 네 종족은');
         Print(15,'     정의의 심판에 의해 무릎을 꿓고');
         Print(15,'     말았다. 이제부터는 새로운 인류');
         Print(15,'     의 역사가 시작 될 것이다.');
      end
      else begin
         Print(15,'   674년 1월 17일. 아프로디테의 베스퍼성이');
         Print(15,'   호전적인  트롤족에 의해  참변을 당했다.');
         Print(15,'   이를 계기로  로어성과  그 이외의 성들은');
         Print(15,'   오크족, 트롤족, 코볼트족,  드라코니안족');
         Print(15,'   에 대한 무차별 정벌을 선포하는 바이다.');
         Print(15,'   이로 인해  인간 이외의 다른 종족에 대한');
         Print(15,'   호의를 일체 중지하며 이제는 적대 관계로');
         Print(15,'   그들을 대할 것이다.');
      end;
   end;

   if mapname = 'Dark' then begin
      if at(51,84) then begin
         Print(15,'          이곳은 로어성입니다.');
         Print(15,'          여러분을 환영합니다.');
         Print(7,'');
         Print(7,'');
         Print(10,'         이곳의 성주 로드안 씀');
      end;
      if at(51,18) or at(52,18) then
         Print(15,'      로어 왕립 죄수 수용소');
      if at(24,31) then begin
         Print(15,'             로어 주점');
         Print(15,'');
         Print(15,'( 코리아 위스키가 잘 팔린다는 말 않겠음 )');
      end;
   end;

   if (mapname = 'LastDtch')  then begin
      if at(39,8) then begin
         Print(15,' 이곳은 가이아 테라로 통하는 게이트 입니다.');
      end;
      if at(39,68) then begin
         Print(7,'');
         Print(15,' 선을 위해서라면 어떤 위험이나 어려움에도');
         Print(15,'굴하지 않는 사람들이 있는 곳, 라스트 디치.');
         Print(7,'');
         Print(15,'           여러분을 환영합니다.');
         Print(7,'');
         Print(7,'');
         Print(13,'            이곳의 성주로부터');
      end;
   end;

   if mapname = 'HdsGate' then begin
      if at(13,22) then begin
         Print(15,'      진정한 길은 마음으로 보아야한다');
         Print(15,'              당신 주위에 있는       ');
         Print(15,'       인위적인 시각 요소를 배제하라');
         Print(15,'          그리고 다시 눈을 떴을때');
         Print(15,'            이미 길은 당신 앞에');
         Print(15,'             펼쳐져 있을 것이다');
      end;
   end;

   if (mapname = 'Valiant') or (mapname = 'Light') then begin
      if at(39,8) then begin
         Print(15,' 이곳은 로어 대륙으로 통하는 게이트 입니다.');
      end;
      if at(39,68) then begin
         Print(7,'');
         Print(15,'   여기는 가이아 테라의 배리언트 피플즈');
         Print(15,'  불의에 대해 가장 강력한 저항을 하는 곳');
         Print(7,'');
         Print(15,'           여러분을 환영합니다.');
         Print(7,'');
         Print(7,'');
         Print(13,'            이곳의 성주로부터');
      end;
   end;

   if mapname = 'Gaea' then begin
      if at(24,26) then begin
         Print(7,'');
         Print(15,'        가이아 테라성의 보물창고');
         Print(15,'            훔쳐가면 죽어 ~~~');
      end;
      if at(29,26) then begin
         Print(7,'');
         Print(15,'   가이아 테라성에 오신 것을 환영합니다');
         Print(15,'    이곳은 쓰레기 종량제 시범 성입니다');
         Print(7,'');
         Print(15,'           여러분을 환영합니다.');
         Print(7,'');
         Print(7,'');
         Print(13,'            이곳의 성주로부터');
      end;
   end;

   if mapname = 'Ground3' then begin
      Print(7,'');
      Print(7,'');
      Print(15,'   이 광산은 아직 개발 중이라 위험하므로');
      Print(15,'              출입을 금지함');
   end;

   if mapname = 'Kobold' then begin
      if at(9,30) then begin
         Print(7,'');
         Print(7,'');
         cPrint(10,11,' 여기서는 믿을만한 기술이 ','투시',' 밖에는 없소');
         Print(10,'    상당히 난해한 곳이 많으니 주의하시오');
         Print(7,'');
         Print(7,'');
         Print(7,'');
         Print(13,'                  로드안');
      end;
      if at(54,63) then begin
         Print(7,'');
         Print(7,'  당신이 원한다면');
         Print(7,'         당신 앞의 용암을 건너게 해주겠소');
         m[0] := '';
         m[1] := '     용암을 건너겠다';
         m[2] := '     건널 필요는 없다';
         k := Select(180,2,2,FALSE,TRUE);
         if k = 1 then begin
            x := 58; y := 63;
            Silent_Scroll;
         end else PutMap(48,73,0);
      end;
   end;

   if mapname = 'DracTown' then begin
      if at(92,94) then begin
         Print(7,'');
         Print(7,'');
         Print(15,'     이곳은 신성한 드라코니안 묘지이므로');
         Print(15,'          함부로 회손 시키지 마시오');
      end;
   end;

   if mapname = 'Imperium' then begin
      if at(24,19) or at(26,19) then begin
         Print(7,'');
         Print(7,'');
         Print(11,'                크리스탈 가게');
         Print(15,'                Crystal  Shop');
         Print(7,'      ( 국제화시대에 부응하기 위해 썼음 )  ');
      end;
      if at(34,23) then begin
         Print(7,'');
         Print(7,'');
         Print(11,'                도서관');
      end;
   end;

end;

end.