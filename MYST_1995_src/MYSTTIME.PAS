Unit MystTime;
{$X+}
{$O+,F+}
INTERFACE

Uses
   Crt, Graph, UHanX, MystSub, Voice, MystBatt, MystEnd;

 Procedure Time_Event(event_no : byte);

IMPLEMENTATION

Procedure ViewMap(Map_no : string; _x, _y : integer);
var
   i,j : integer;
   seek_point : word;
   X_len, Y_len : byte;
   _FILE : file;
   Dark : boolean;
   Aux_Map_Header : ^Map_Header_Type;
   map_buf : array[1..11,1..9] of byte;
begin
   assign(_FILE,Map_no+'.m');
   reset(_FILE,1);
   new(Aux_Map_Header);
   BlockRead(_FILE,Aux_Map_Header^,sizeof(Aux_Map_Header^));
   X_len := Aux_Map_Header^.xmax;
   Y_len := Aux_Map_Header^.ymax;
   dispose(Aux_Map_Header);
   _x := _x - 4; _y := _y - 5;
   seek_point := sizeof(Aux_Map_Header^) + (_y - 1) * X_len + (_x - 1);
   seek(_FILE,seek_point);
   for j := 1 to 11 do begin
      BlockRead(_File,map_buf[j],9);
      seek_point := seek_point + X_len;
      seek(_FILE,seek_point);
   end;
   close(_FILE);
   if party.hour in [7..17] then Dark := FALSE
   else begin
      Dark := TRUE;
      if not((party.day mod 30 + 1) in [10..20]) then fillchar(map_buf,sizeof(map_buf),chr(55));
   end;
   _IMAGE_DIRECTION := _STORE;
   for j := 1 to 11 do for i := 1 to 9 do Image(i,j,Font^[map_buf[j,i] and $7F],Dark);
   Screen_Fade_In(600);
   _IMAGE_DIRECTION := _DIRECT;
   for j := 1 to 11 do for i := 1 to 9 do Image(i,j,Font^[map_buf[j,i] and $7F],Dark);
   Clear;
   Print(7,' 당신은 수정구슬을 통해 낯선 풍경을 보았다.');
   PressAnyKey;
   OverLap(600,TRUE);
   Silent_Scroll;
end;

Procedure Time_Event(event_no : byte);
label
   JUMP_TO_THE_FUTURE;
var
   battle_number : byte;
begin
   case event_no of
      0 : begin
             Clear;
             Print(7,' 갑자기 허공 속에서  에인션트 이블의 음성이');
             Print(7,'들려왔다.');
             delay(1000);
             PressAnyKey;
             Print(9,' '+player[1].name+', 정말 급한 일이 생겼습니다.');
             Print(9,' 방금 당신이 로드안에 대해 반란을 결심한 것');
             Print(9,'을 로드안이 알아챘습니다.  아마 그는 천리안');
             Print(9,'과 독심으로  당신을 계속  관찰했던것 같습니');
             Print(9,'다.  지금 로어성에서는 당신과 배리언트 피플');
             Print(9,'즈의 사람들을 제거할 용사들을 모으기 시작했');
             Print(9,'습니다.  그리고 적어도 몇일후면 이곳으로 진');
             Print(9,'격한다고 합니다.  당신의 능력이라면  충분히');
             Print(9,'자신을 방어할 수 있겠지만  모든 배리언트 피');
             Print(9,'플즈의 사람들을 보호해 주기란 역부족 일것입');
             Print(9,'니다.  그래서 한시바삐 이곳 사람들을 안전한');
             Print(9,'곳으로 이동 시켜 주었으면 합니다. 당신은 그');
             Print(9,'들이 살기 좋을만하고 절대로 로드안의 투시능');
             Print(9,'력이 미치지 않을 곳을 찾아 주십시요. 그리고');
             Print(9,'그 위치를 알려주시면 나머지는 제가 담당하겠');
             Print(9,'습니다.');
             Print(9,'');
             PressAnyKey;
             mapname := 'HdsGate';
             Load;
             Silent_Scroll;
             Print(9,' 지금 당신이 서있는 곳은  ''하데스 게이트''라');
             Print(9,'는 곳입니다. 이곳은 로어세계의 6번째 테라인');
             Print(9,'하데스 테라로  이동하는 문이  있는 곳이기도');
             Print(9,'합니다. 하데스 테라는 로어 대륙의 지하에 있');
             Print(9,'으며  로드안과 나의 투시능력이  전혀 통하지');
             Print(9,'못하는 곳입니다.  당신은 이곳을 통해 하데스');
             Print(9,'테라로 간후 배리언트 피플즈의 주민들이 안전');
             Print(9,'하게  살 수 있는 곳을  찾아내면 되는 것입니');
             Print(9,'다. 아마 당신의 투시능력이 큰 도움을 줄것입');
             Print(9,'니다.  제가 당신에게 크로매틱 크리스탈을 드');
             Print(9,'리겠습니다.  당신이 가장 좋은 장소를 찾았을');
             Print(9,'때 이 크리스탈을 사용하십시요.  그리면 저의');
             Print(9,'투시력과  그 크리스탈이 서로 교감하여  나의');
             Print(9,'투시력이 그곳으로 작용할 것입니다.');
             Print(9,' 당신의 성공을 빌겠습니다.');
             Print(9,'');
             inc(party.crystal[8]);
             PressAnyKey;
          end;
      1 : begin
             mapname := 'Dome';
             Load;
             for j := 1 to Map_Header.ymax do
             for i := 1 to Map_Header.xmax do
             if Real_Map(i,j) = 0 then PutMap(i,j,47);
             PutMap(26,14,35);
             PutMap(13,27,44);
             PutMap(22,35,47);
             PutMap(39,29,31);
             PutMap(19,54,44);
             PutMap(30,63,47);
             PutMap(19,73,47);
             PutMap(38,41,31);
             x := 25;
             y := 50;
             Silent_Scroll;
             Clear;
             Print(9,' 휴...  저의 염력을 총동원하여 어느 정도 사');
             Print(9,'람이 살 수 있는 도시를  건설해  보았습니다.');
             Print(9,'이제는 배리언트 피플즈의 사람들을 여기로 공');
             Print(9,'간이동 시켜 보겠습니다.  이번에도 조금 기다');
             Print(9,'려야 할 것입니다');
             with party do begin
                watch_year := year;
                watch_day := day;
                watch_hour := hour;
                watch_min := min;
                watch_sec := sec;
             end;
             Time_Watch := TRUE;
             Time_Event_No := 2;
             watch_min := watch_min + 30;
             if watch_min > 59 then begin
                watch_min := watch_min - 60;
                watch_hour := watch_hour + 1;
                if watch_hour > 23 then begin
                   watch_hour := watch_hour - 24;
                   watch_day := watch_day + 1;
                   if watch_day > 359 then begin
                      watch_day := watch_day - 360;
                      watch_year := watch_year + 1;
                   end;
                end;
             end;
          end;
      2 : begin
             mapname := 'Dome';
             i := x; j := y;
             Load;
             x := i; y := j;
             while not (Real_Map(x,y) in [27..47]) do inc(x);
             Silent_Scroll;
             Clear;
             Print(9,' 이곳으로 오기 원하는  모든 배리언트 피플즈');
             Print(9,'의 사람들을 이곳으로 불렀습니다.  여기의 사');
             Print(9,'람들과 이야기를 나눈후 성밖으로 나올때 당신');
             Print(9,'을 지상세계로 이동 시켜 주겠습니다. 좋은 이');
             Print(9,'야기 많이 나누시기 바랍니다.');
             setbit(32);
          end;
      3 : begin
             Clear;
             Print(7,' 당신이 길을 가던중 당신의 동료였던 그 사람');
             Print(7,'들을 만나게 되었다.');
             delay(1000);
             PressAnyKey;
             Print(6,' 드디어 만났군, '+player[1].name+'.');
             Print(6,' 로드안을 배신하겠다는 자네의 생각이 옳았다');
             Print(6,'네.  우리가 자네와 헤어진후 로드안에게 갔을');
             Print(6,'때  로드안은 우리에게 멸망당한 네 종족의 원');
             Print(6,'혼을 봉인하는 일을 시켰다네. 우리는 쾌히 승');
             Print(6,'락하며 그 일을 해주었지. 하지만 우리의 도움');
             Print(6,'이 더 이상 필요없게 되자 로드안은 그 자신을');
             Print(6,'위해  우리의 동료였던 카노푸스를  악의 전사');
             Print(6,'네크로만서로 개조하여 다른 차원으로 보내 버');
             Print(6,'렸다네.  우리는 그 사실을 알아채자 로어성을');
             Print(6,'탈출하여 자네를 찾아 여기까지 왔다네.  자네');
             Print(6,'와 다시 합류하여 로드안과 싸우고 싶네.');
             for i := 1 to 5 do Print(6,'');
             m[0] := '';
             m[1] := '쾌히 승락하겠네';
             m[2] := '하지만 이미 늦었네';
             if Select(230,2,2,FALSE,TRUE) <> 2 then begin
                for i := 2 to 5 do begin
                   for j := 0 to 8 do player[i].name[j] := player[i].name[j+9];
                end;
                Display_Condition;
                setbit(49);
             end;
             with party do begin
                watch_year := year;
                watch_day := day;
                watch_hour := hour;
                watch_min := min;
                watch_sec := sec;
             end;
             Time_Watch := TRUE;
             Time_Event_No := 4;
             watch_min := watch_min + 30;
             if watch_min > 59 then begin
                watch_min := watch_min - 60;
                watch_hour := watch_hour + 1;
                if watch_hour > 23 then begin
                   watch_hour := watch_hour - 24;
                   watch_day := watch_day + 1;
                   if watch_day > 359 then begin
                      watch_day := watch_day - 360;
                      watch_year := watch_year + 1;
                   end;
                end;
             end;
          end;
      4 : begin
             Clear;
             Print(7,' 당신이 길을 가던중 갑자기 강한 기운이 둘러');
             Print(7,'싸고 있음을 알아챘다.  기척을 없에고 투시로');
             Print(7,'주위를 보았을때 사방을 포위하고 있는 로어성');
             Print(7,'의 병사들을 볼 수 있었다. 로드안이 천리안으');
             Print(7,'로  우리들을 찾아내어  이곳으로 대군을 보낸');
             Print(7,'것임에 틀림없었다.  우리들은 곧 벌어질 전투');
             Print(7,'를 위해 태세를 갖추었다. 당신이 투시로 주위');
             Print(7,'를 경계하던중 놀랍게도 대군을 직접 지휘하는');
             Print(7,'로드안을 보았다.  그가 직접 나섰다면 그만큼');
             Print(7,'나의 승산도 줄어든다는걸  알고있었다.  이제');
             Print(7,'결론은 단 한가지였다.  바로 로드안이 있는쪽');
             Print(7,'으로 뚫고 들어가 그와 상대하는 것이었다. 그');
             Print(7,'리고 내가 그를 꺽어버린다면 대부분의 병사들');
             Print(7,'은 사기를 잃고  도망가버릴 것이기 때문이다.');
             Print(7,'일행은  서로에게 신호를 보내며  나의 생각에');
             Print(7,'동의를 표했다. 이제는 지체할 시간이 없었다.');
             Print(7,'우리들은  곧바로 로드안이 있는 쪽을 향해 뚫');
             Print(7,'고 들어가기 시작했다.');
             Print(7,'');
             PressAnyKey;
             for battle_number := 1 to 5 do begin
                Clear;
                enemynumber := 8;
                for i := 1 to 8 do joinenemy(i,67);
                repeat
                   DisplayEnemies(TRUE);
                   BattleMode(TRUE,FALSE);
                   if party.etc[6] = 254 then exit;
                   if party.etc[6] = 2 then begin
                      Clear;
                      Print(7,' 일행은 너무 많은 적들에게 포위되어서 도망');
                      Print(7,'갈 수가 없었다.');
                      PressAnyKey;
                   end;
                until party.etc[6] = 0;
                EndBattle(i);
                if i = 1 then goto JUMP_TO_THE_FUTURE;
             end;
             for battle_number := 1 to 4 do begin
                Clear;
                enemynumber := 8;
                for i := 1 to 6 do joinenemy(i,67);
                joinenemy(7,68);
                joinenemy(8,69);
                repeat
                   DisplayEnemies(TRUE);
                   BattleMode(TRUE,FALSE);
                   if party.etc[6] = 254 then exit;
                   if party.etc[6] = 2 then begin
                      Clear;
                      Print(7,' 일행은 너무 많은 적들에게 포위되어서 도망');
                      Print(7,'갈 수가 없었다.');
                      PressAnyKey;
                   end;
                until party.etc[6] = 0;
                EndBattle(i);
                if i = 1 then goto JUMP_TO_THE_FUTURE;
             end;
             for battle_number := 1 to 2 do begin
                Clear;
                enemynumber := 8;
                for i := 1 to 4 do joinenemy(i,69);
                for i := 5 to 8 do joinenemy(i,68);
                repeat
                   DisplayEnemies(TRUE);
                   BattleMode(TRUE,FALSE);
                   if party.etc[6] = 254 then exit;
                   if party.etc[6] = 2 then begin
                      Clear;
                      Print(7,' 일행은 너무 많은 적들에게 포위되어서 도망');
                      Print(7,'갈 수가 없었다.');
                      PressAnyKey;
                   end;
                until party.etc[6] = 0;
                EndBattle(i);
                if i = 1 then goto JUMP_TO_THE_FUTURE;
             end;
             Clear;
             enemynumber := 8;
             for i := 1 to 4 do joinenemy(i,68);
             for i := 5 to 7 do joinenemy(i,69);
             joinenemy(8,70);
             repeat
                DisplayEnemies(TRUE);
                BattleMode(FALSE,FALSE);
                if party.etc[6] = 254 then exit;
                if party.etc[6] = 2 then begin
                   Clear;
                   Print(7,' 일행은 너무 많은 적들에게 포위되어서 도망');
                   Print(7,'갈 수가 없었다.');
                   PressAnyKey;
                end;
             until party.etc[6] = 0;
             EndBattle(i);
             if i = 1 then goto JUMP_TO_THE_FUTURE;
             enemynumber := 8;
             for i := 1 to 6 do joinenemy(i,71);
             joinenemy(7,72);
             joinenemy(8,73);
             repeat
                DisplayEnemies(TRUE);
                BattleMode(TRUE,FALSE);
                if party.etc[6] = 254 then exit;
                if party.etc[6] = 2 then begin
                   Clear;
                   Print(7,' 일행은 너무 많은 적들에게 포위되어서 도망');
                   Print(7,'갈 수가 없었다.');
                   PressAnyKey;
                end;
             until party.etc[6] = 0;
             EndBattle(i);
             if i = 1 then goto JUMP_TO_THE_FUTURE;
             Clear;
             Print(7,' 당신은  힘겹게 로드안을 물리쳤다.  그리고');
             Print(7,'예상대로  로어성의 병사들은  자신의 군주가');
             Print(7,'패하자 뿔뿔이 흩어져 버렸다. 벌판에는 당신');
             Print(7,'이 죽인 수 많은 시체가 널려있었다.');
             mapname := 'Lore';
             Load;
             x := 51; y := 31;
             PutMap(51,28,42);
             PressAnyKey;
             OverLap(1000,FALSE);
             Print(7,'얼마후 로어성에는 성대한 의식이 행해졌다.');
             face := 1;
             if player[1].classtype = magic then inc(face,8);
             for j := 11 downto 3 do begin
                if j < 11 then PutTile(5,j+1,42);
                PutSprite(5,j,face);
                delay(800);
             end;
             face := 0;
             if player[1].classtype = magic then inc(face,8);
             PutTile(5,3,42);
             PutSprite(5,3,face);
             Print(7,' 그것은  바로 새로운 군주를 탄생 시키는 자');
             Print(7,'리였다. 진정한 선을 행할 수 있는 자만이 설');
             Print(7,'수 있는 자리.');
             delay(1500);
             for i := 1 to 4 do begin
                if i > 1 then PutTile(i-1,3,Real_Map(x-5+i-1,y-3));
                PutSprite(i,3,21);
                delay(800);
             end;
             delay(1500);
             PutTile(5,3,54);
             for i := 4 downto 1 do begin
                PutTile(i,3,Real_Map(x-5+i,y-3));
                if i > 1 then begin
                   PutSprite(i-1,3,22);
                end;
                delay(800);
             end;
             Print(7,' 그 의식의 주인공은 바로 당신이었다.  새로');
             Print(7,'운  로어 세계의 역사를 창조하는  그 순간을');
             Print(7,'모든 사람들은 두손 모아 찬미하였다.');
             PressAnyKey;
             End_Demo(2);

JUMP_TO_THE_FUTURE:
             Scroll(TRUE);
             Clear;
             Print(7,' 이제는 로드안에게 패하는구나하며 모든것을');
             Print(7,'단념하려는 순간  빛나는 광채가 당신을 둘러');
             Print(7,'싸기 시작했다. 그리고는 빨려 들어가듯 당신');
             Print(7,'을 감싸던 광채는 차원의 틈속으로 당신을 몰');
             Print(7,'아넣었다.');
             delay(1000);
             PressAnyKey;
             Delete_Scroll_Screen;
             mapname := 'Ground1';
             Load;
             x := 58; y := 79;
             with party do begin
                year := 795;
                day := 18;
                hour := 9;
                min := 0;
                sec := 0;
             end;
             for i := 1 to 6 do
             with player[i] do
             if name <> '' then begin
                hp := 1;
                poison := 0;
                unconscious := 0;
                dead := 0;
             end;
             Display_Condition;
             Print(7,' 얼마나 아득한 순간이 지났을까...');
             Print(7,' 당신은 문득 정신을 차렸다.  그리고 당신이');
             Print(7,'본 것은 뭔가 낯선듯한 로어 대륙의 모습이었');
             Print(7,'다.');
             OverLap(500,TRUE);
             PressAnyKey;
             Print(7,' 당신의 귓가에서 귀에 익은 목소리가 울려퍼');
             Print(7,'졌다.');
             Print(7,'');
             Print(10,' 나는 당신을 이런 운명으로 끌어들였던 알비');
             Print(10,'레오라는 예언자이오. 물론 당신은 나를 알겠');
             Print(10,'지요.  나는 이곳의 존재가 아니라서  이곳의');
             Print(10,'역사에 관여할 자격은 없소.  하지만  당신의');
             Print(10,'위급한 상황을 보고는 참을 수가 없어서 차원');
             Print(10,'이탈 마법으로 당신을 795년으로 오게했소.');
             Print(10,'');
             Print(10,' 이미 로어 세계는  당신을 잊혀진 인물로 평');
             Print(10,'가할 정도의 세월이 지났소.  결코 당신을 알');
             Print(10,'아볼 사람은 이곳에 없을거요. 세상의 최강자');
             Print(10,'였던 로드안은 이제 기력이 많이 약해져서 지');
             Print(10,'금 당신의 맞수로서 충분하리라 생각하오. 이');
             Print(10,'제 당신은 별 제약없이 로어성으로 들어갈 수');
             Print(10,'있을거요.');
             Print(10,' 거기서  최후의 결전을 벌여  진정한 정의를');
             Print(10,'실현하시오. 행운을 빌겠소.');
             Print(10,'');
             PressAnyKey;
          end;
      5 : case party.etc[26] of
            0 : if (mapname = 'Ground2') and on(92,12) then begin
                   enemynumber := 1;
                   joinenemy(1,60);
                   repeat
                      DisplayEnemies(TRUE);
                      BattleMode(FALSE,TRUE);
                      if party.etc[6] = 254 then exit;
                      if party.etc[6] = 2 then Clear;
                   until party.etc[6] = 0;
                   Clear;
                   Print(15,' 당신은 오크의 원혼을 크리스탈 볼 속에 봉인');
                   Print(15,'시켰다.');
                   inc(party.etc[26]);
                end else ViewMap('Ground2',92,12);
            1 : if (mapname = 'Ground3') and on(35,34) then begin
                   enemynumber := 1;
                   joinenemy(1,61);
                   repeat
                      DisplayEnemies(TRUE);
                      BattleMode(FALSE,TRUE);
                      if party.etc[6] = 254 then exit;
                      if party.etc[6] = 2 then Clear;
                   until party.etc[6] = 0;
                   Clear;
                   Print(15,' 당신은 트롤의 원혼을 크리스탈 볼 속에 봉인');
                   Print(15,'시켰다.');
                   inc(party.etc[26]);
                end else ViewMap('Ground3',35,34);
            2 : if (mapname = 'Ground4') and on(11,91) then begin
                   enemynumber := 1;
                   joinenemy(1,62);
                   repeat
                      DisplayEnemies(TRUE);
                      BattleMode(FALSE,TRUE);
                      if party.etc[6] = 254 then exit;
                      if party.etc[6] = 2 then Clear;
                   until party.etc[6] = 0;
                   Clear;
                   Print(15,' 당신은 코볼트의 원혼을 크리스탈 볼 속에 봉');
                   Print(15,'인 시켰다.');
                   inc(party.etc[26]);
                end else ViewMap('Ground4',11,91);
            3 : if (mapname = 'Ground1') and on(44,50) then begin
                   enemynumber := 1;
                   joinenemy(1,63);
                   repeat
                      DisplayEnemies(TRUE);
                      BattleMode(FALSE,TRUE);
                      if party.etc[6] = 254 then exit;
                      if party.etc[6] = 2 then Clear;
                   until party.etc[6] = 0;
                   Clear;
                   Print(15,' 당신은 드라콘의 원혼을 크리스탈 볼 속에 봉');
                   Print(15,'인 시켰다.');
                   inc(party.etc[26]);
                   party.etc[20] := 11;
                end else ViewMap('Ground1',44,50);
            4 : begin
                   Clear;
                   Print(7,' 크리스탈 볼 속에는  아무것도 떠오르지 않았');
                   Print(7,'다.');
                end;
          end;
   end;
end;

end.
